// Generated by CoffeeScript 1.8.0
var initCommonVar, initResize, initScrollPoint, initTimeline, initView, setupScrollEvent;

initCommonVar = function() {
  window.wrap = $('#main-wrapper');
  window.scrollWrapper = $("#scroll_wrapper");
  window.scrollHandleWrapper = $("#scroll_handle_wrapper");
  window.scrollHandle = $("#scroll_handle");
  window.scrollContents = $("#scroll_contents");
  window.scrollInside = $("#scroll_inside");
  window.distX = 0;
  window.distY = 0;
  window.scrollViewMag = 500;
  window.resizeTimer = false;
  window.timeLine = null;
  window.scrollViewZindex = 100;
  return window.lstorage = localStorage;
};

initView = function() {
  $('#contents').css('height', $('#contents').height() - $('#nav').height());
  $('#canvas_container').attr('width', $('#canvas_wrapper').width());
  $('#canvas_container').attr('height', $('#canvas_wrapper').height());
  scrollWrapper.css('z-index', scrollViewZindex);
  scrollInside.width(scrollContents.width() * (scrollViewMag + 1));
  scrollInside.height(scrollContents.height() * (scrollViewMag + 1));
  scrollHandle.width(scrollHandleWrapper.width() * (scrollViewMag + 1));
  scrollHandle.height(scrollHandleWrapper.height() * (scrollViewMag + 1));
  scrollContents.scrollLeft(scrollContents.width() * (scrollViewMag * 0.5));
  scrollContents.scrollTop(scrollContents.height() * (scrollViewMag * 0.5));
  scrollHandleWrapper.scrollLeft(scrollHandleWrapper.width() * (scrollViewMag * 0.5));
  return scrollHandleWrapper.scrollTop(scrollHandleWrapper.height() * (scrollViewMag * 0.5));
};

initResize = function(wrap, scrollWrapper) {
  var resizeTimer;
  resizeTimer = false;
  return $(window).resize(function() {
    if (resizeTimer !== false) {
      clearTimeout(resizeTimer);
    }
    return resizeTimer = setTimeout(function() {
      var h;
      h = $(window).height();
      wrap.height(h);
      return scrollWrapper.height(h);
    }, 200);
  });
};

initTimeline = function() {
  var chapterList, objList;
  objList = JSON.parse(lstorage.getItem('timelineObjList'));
  chapterList = [];
  objList.forEach(function(obj) {
    var actorList, chapter, item, miniObj;
    actorList = [];
    miniObj = obj.miniObj;
    if (miniObj.itemType === Constant.ItemType.BUTTON) {
      item = new ButtonItem();
      item.initActor(miniObj, obj.itemSize, obj.sEvent, obj.cEvent);
      item.reDraw();
    } else if (miniObj.itemType === Constant.ItemType.ARROW) {
      item = new ArrowItem();
      item.initActor(miniObj, obj.itemSize, obj.sEvent, obj.cEvent);
      item.reDraw(false);
    }
    actorList.push(item);
    if (miniObj.itemType === Constant.ItemType.BUTTON) {
      chapter = new ClickChapter(actorList);
    } else if (miniObj.itemType === Constant.ItemType.ARROW) {
      chapter = new ScrollChapter(actorList);
    }
    return chapterList.push(chapter);
  });
  return window.timeLine = new TimeLine(chapterList);
};

initScrollPoint = function() {
  scrollHandleWrapper.scrollLeft(scrollHandleWrapper.width() * (scrollViewMag * 0.5));
  return scrollHandleWrapper.scrollTop(scrollHandleWrapper.height() * (scrollViewMag * 0.5));
};

setupScrollEvent = function() {
  var lastLeft, lastTop, scrollFinished, stopTimer;
  lastLeft = scrollHandleWrapper.scrollLeft();
  lastTop = scrollHandleWrapper.scrollTop();
  stopTimer = null;
  scrollHandleWrapper.scroll(function() {
    var distX, distY, x, y;
    x = $(this).scrollLeft();
    y = $(this).scrollTop();
    if (stopTimer !== null) {
      clearTimeout(stopTimer);
    }
    stopTimer = setTimeout((function(_this) {
      return function() {
        initScrollPoint();
        lastLeft = $(_this).scrollLeft();
        lastTop = $(_this).scrollTop();
        clearTimeout(stopTimer);
        return stopTimer = null;
      };
    })(this), 100);
    distX = x - lastLeft;
    distY = y - lastTop;
    lastLeft = x;
    lastTop = y;
    console.log('distX:' + distX + ' distY:' + distY);
    return timeLine.handleScrollEvent(distX, distY);
  });
  return scrollFinished = function() {};
};

$(function() {
  initCommonVar();
  initView();
  initScrollPoint();
  initTimeline();
  setupScrollEvent();
  return $('#sup_css').html(lstorage.getItem('itemCssStyle'));
});

//# sourceMappingURL=look_around.js.js.map
