// Generated by CoffeeScript 1.10.0
var Navbar;

Navbar = (function() {
  function Navbar() {}

  Navbar.NAVBAR_ROOT = constant.ElementAttribute.NAVBAR_ROOT;

  Navbar.ITEM_MENU_PREFIX = 'menu-item-';

  Navbar.initWorktableNavbar = function() {
    var etcMenuEmt, fileMenuEmt, itemsSelectMenuEmt, menuSave;
    fileMenuEmt = $('#header_items_file_menu .dropdown-menu > li');
    $('.menu-newcreate', fileMenuEmt).off('click');
    $('.menu-newcreate', fileMenuEmt).on('click', function() {
      if (Object.keys(window.instanceMap).length > 0 || PageValue.getPageCount() >= 2) {
        if (window.confirm(I18n.t('message.dialog.new_project'))) {
          WorktableCommon.recreateMainContainer();
          return Common.showModalView(Constant.ModalViewType.INIT_PROJECT, Project.initProjectModal, false);
        }
      } else {
        WorktableCommon.recreateMainContainer();
        return Common.showModalView(Constant.ModalViewType.INIT_PROJECT, Project.initProjectModal, false);
      }
    });
    menuSave = $('.menu-save', fileMenuEmt);
    menuSave.off('click');
    menuSave.on('click', function() {
      return ServerStorage.save();
    });
    menuSave.off('mouseenter');
    menuSave.on('mouseenter', function(e) {
      var d, lastSaveTime, li, n;
      lastSaveTime = PageValue.getGeneralPageValue(PageValue.Key.LAST_SAVE_TIME);
      if (lastSaveTime != null) {
        n = $.now();
        d = new Date(lastSaveTime);
        li = this.closest('li');
        $(li).append($("<div class='pop' style='display:none'><p>Last Save " + (Common.displayDiffAlmostTime(n, d.getTime())) + "</p></div>"));
        $('.pop', li).css({
          top: $(li).height() + 30,
          left: $(li).width()
        });
        return $('.pop', li).show();
      }
    });
    menuSave.off('mouseleave');
    menuSave.on('mouseleave', function(e) {
      var ul;
      ul = this.closest('ul');
      return $('.pop', ul).remove();
    });
    $('.menu-setting', fileMenuEmt).off('click');
    $('.menu-setting', fileMenuEmt).on('click', function() {
      Sidebar.switchSidebarConfig(Sidebar.Type.SETTING);
      WorktableSetting.initConfig();
      return Sidebar.openConfigSidebar();
    });
    etcMenuEmt = $('#header_etc_select_menu .dropdown-menu > li');
    $('.menu-about', etcMenuEmt).off('click');
    $('.menu-about', etcMenuEmt).on('click', function() {
      return Common.showModalView(Constant.ModalViewType.ABOUT);
    });
    $('.menu-backtomainpage', etcMenuEmt).off('click');
    $('.menu-backtomainpage', etcMenuEmt).on('click', function() {
      return window.location.href = '/';
    });
    itemsSelectMenuEmt = $('#header_items_select_menu .dropdown-menu > li');
    $('.menu-item', itemsSelectMenuEmt).click(function() {
      var emtId, itemId;
      WorktableCommon.reDrawAllInstanceItemIfChanging();
      WorktableCommon.clearSelectedBorder();
      emtId = $(this).attr('id');
      if (emtId.indexOf(Navbar.ITEM_MENU_PREFIX) >= 0) {
        itemId = parseInt(emtId.replace(Navbar.ITEM_MENU_PREFIX, ''));
        Navbar.setModeDraw(itemId);
        return WorktableCommon.changeMode(Constant.Mode.DRAW);
      }
    });
    $('#header_items_select_menu .menu-item').click(function() {
      var selected;
      selected = $(this).html();
      return $('#header_items_selected_menu_span').html(selected);
    });
    $('#menu-action-edit').click(function() {
      Navbar.setModeEdit();
      return WorktableCommon.changeMode(Constant.Mode.EDIT);
    });
    $('#menu_sidebar_toggle').off('click');
    return $('#menu_sidebar_toggle').on('click', function() {
      Sidebar.switchSidebarConfig(Sidebar.Type.STATE);
      StateConfig.initConfig();
      return Sidebar.openConfigSidebar();
    });
  };

  Navbar.initRunNavbar = function() {
    var navEmt;
    navEmt = $('#nav');
    $('.menu-showguide', navEmt).off('click');
    $('.menu-showguide', navEmt).on('click', function() {
      return RunSetting.toggleShowGuide();
    });
    $('.menu-control-rewind-page', navEmt).off('click');
    $('.menu-control-rewind-page', navEmt).on('click', function() {
      if (window.eventAction != null) {
        return window.eventAction.thisPage().rewindAllChapters();
      }
    });
    $('.menu-control-rewind-chapter', navEmt).off('click');
    $('.menu-control-rewind-chapter', navEmt).on('click', function() {
      if (window.eventAction != null) {
        return window.eventAction.thisPage().rewindChapter();
      }
    });
    $('.menu-upload-gallery', navEmt).off('click');
    return $('.menu-upload-gallery', navEmt).on('click', function() {
      return RunCommon.showUploadGalleryConfirm();
    });
  };

  Navbar.setModeDraw = function(itemId, callback) {
    var emtId, itemsSelectMenuEmt;
    if (callback == null) {
      callback = null;
    }
    itemsSelectMenuEmt = $('#header_items_select_menu .dropdown-menu > li');
    itemsSelectMenuEmt.removeClass('active');
    emtId = "menu-item-" + itemId;
    $("#" + emtId).parent('li').addClass('active');
    window.selectItemMenu = itemId;
    return Common.loadItemJs(itemId, callback);
  };

  Navbar.setModeEdit = function() {
    var itemsSelectMenuEmt;
    itemsSelectMenuEmt = $('#header_items_select_menu .dropdown-menu > li');
    itemsSelectMenuEmt.removeClass('active');
    return $('#menu-action-edit').parent('li').addClass('active');
  };

  return Navbar;

})();

//# sourceMappingURL=navbar.js.map
