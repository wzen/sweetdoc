// Generated by CoffeeScript 1.9.2
var Page;

Page = (function() {
  function Page(eventPageValueList) {
    var eventList;
    this.chapterList = [];
    if (eventPageValueList != null) {
      eventList = [];
      $.each(eventPageValueList, (function(_this) {
        return function(idx, obj) {
          var beforeEvent, chapter, parallel;
          eventList.push(obj);
          parallel = false;
          if (idx < eventPageValueList.length - 1) {
            beforeEvent = eventPageValueList[idx + 1];
            if (beforeEvent[EventPageValueBase.PageValueKey.IS_PARALLEL]) {
              parallel = true;
            }
          }
          if (!parallel) {
            chapter = null;
            if (obj[EventPageValueBase.PageValueKey.ACTIONTYPE] === Constant.ActionEventHandleType.CLICK) {
              chapter = new ClickChapter({
                eventList: eventList,
                num: idx
              });
            } else {
              chapter = new ScrollChapter({
                eventList: eventList,
                num: idx
              });
            }
            _this.chapterList.push(chapter);
            eventList = [];
          }
          return true;
        };
      })(this));
    }
    this.chapterIndex = 0;
    this.doMovePage = false;
    this.finishedAllChapters = false;
  }

  Page.prototype.thisChapter = function() {
    return this.chapterList[this.chapterIndex];
  };

  Page.prototype.start = function() {
    Navbar.setChapterNum(this.chapterIndex + 1);
    this.sinkFrontAllChapterObj();
    return this.thisChapter().willChapter();
  };

  Page.prototype.nextChapterIfFinishedAllEvent = function() {
    if (this.thisChapter().finishedAllEvent()) {
      return this.nextChapter();
    }
  };

  Page.prototype.nextChapter = function() {
    this.thisChapter().didChapter();
    this.chapterIndex += 1;
    if (this.chapterList.length <= this.chapterIndex) {
      return this.finishAllChapters();
    } else {
      Navbar.setChapterNum(this.chapterIndex + 1);
      return this.thisChapter().willChapter();
    }
  };

  Page.prototype.rewindChapter = function() {
    this.resetChapter(this.chapterIndex);
    if (!this.thisChapter().doMoveChapter && this.chapterIndex > 0) {
      this.chapterIndex -= 1;
      this.resetChapter(this.chapterIndex);
    }
    return this.thisChapter().willChapter();
  };

  Page.prototype.resetChapter = function(chapterIndex) {
    return this.chapterList[chapterIndex].reset();
  };

  Page.prototype.rewindAllChapters = function() {
    var chapter, i, j, ref;
    for (i = j = ref = this.chapterList.length - 1; j >= 0; i = j += -1) {
      chapter = this.chapterList[i];
      chapter.reset();
    }
    this.chapterIndex = 0;
    this.finishedAllChapters = false;
    return this.start();
  };

  Page.prototype.handleScrollEvent = function(x, y) {
    if (!this.finishedAllChapters && this.isScrollChapter()) {
      return this.thisChapter().scrollEvent(x, y);
    }
  };

  Page.prototype.isScrollChapter = function() {
    return this.thisChapter().scrollEvent != null;
  };

  Page.prototype.sinkFrontAllChapterObj = function() {
    scrollHandleWrapper.css('z-index', scrollViewSwitchZindex.on);
    scrollContents.css('z-index', scrollViewSwitchZindex.off);
    return this.chapterList.forEach(function(chapter) {
      return chapter.eventObjList.forEach(function(event) {
        if (event.event[EventPageValueBase.PageValueKey.IS_COMMON_EVENT] === false) {
          return event.getJQueryElement().css('z-index', Common.plusPagingZindex(Constant.Zindex.EVENTBOTTOM + chapter.num));
        }
      });
    });
  };

  Page.prototype.willPage = function() {
    this.initChapterEvent();
    this.initFocus();
    this.thisChapter().reset();
    Navbar.setChapterMax(this.chapterList.length);
    return LocalStorage.saveValueForRun();
  };

  Page.prototype.didPage = function() {};

  Page.prototype.initChapterEvent = function() {
    var chapter, event, i, j, len, ref, results;
    ref = this.chapterList;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      chapter = ref[j];
      results.push((function() {
        var k, ref1, results1;
        results1 = [];
        for (i = k = 0, ref1 = chapter.eventObjList.length - 1; 0 <= ref1 ? k <= ref1 : k >= ref1; i = 0 <= ref1 ? ++k : --k) {
          event = chapter.eventObjList[i];
          results1.push(event.initWithEvent(chapter.eventList[i]));
        }
        return results1;
      })());
    }
    return results;
  };

  Page.prototype.initFocus = function() {
    var chapter, event, j, len, ref, results;
    ref = this.chapterList;
    results = [];
    for (j = 0, len = ref.length; j < len; j++) {
      chapter = ref[j];
      results.push((function() {
        var k, len1, ref1, results1;
        ref1 = chapter.eventList;
        results1 = [];
        for (k = 0, len1 = ref1.length; k < len1; k++) {
          event = ref1[k];
          if (!event[EventPageValueBase.PageValueKey.IS_COMMON_EVENT]) {
            results1.push(chapter.focusToActorIfNeed(true));
          } else {
            results1.push(void 0);
          }
        }
        return results1;
      })());
    }
    return results;
  };

  Page.prototype.reset = function() {
    return this.chapterList.forEach(function(chapter) {
      return chapter.reset();
    });
  };

  Page.prototype.finishAllChapters = function() {
    this.finishedAllChapters = true;
    return console.log('Finish All Events!');
  };

  return Page;

})();

//# sourceMappingURL=page.js.map
