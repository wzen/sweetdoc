// Generated by CoffeeScript 1.10.0
var RunCommon;

RunCommon = (function() {
  var constant;

  function RunCommon() {}

  constant = gon["const"];

  RunCommon.RUN_CSS = constant.ElementAttribute.RUN_CSS;

  RunCommon.AttributeName = (function() {
    function AttributeName() {}

    AttributeName.CONTENTS_CREATOR_CLASSNAME = constant.Run.AttributeName.CONTENTS_CREATOR_CLASSNAME;

    AttributeName.CONTENTS_TITLE_CLASSNAME = constant.Run.AttributeName.CONTENTS_TITLE_CLASSNAME;

    AttributeName.CONTENTS_CAPTION_CLASSNAME = constant.Run.AttributeName.CONTENTS_CAPTION_CLASSNAME;

    AttributeName.CONTENTS_PAGE_NUM_CLASSNAME = constant.Run.AttributeName.CONTENTS_PAGE_NUM_CLASSNAME;

    AttributeName.CONTENTS_PAGE_MAX_CLASSNAME = constant.Run.AttributeName.CONTENTS_PAGE_MAX_CLASSNAME;

    AttributeName.CONTENTS_CHAPTER_NUM_CLASSNAME = constant.Run.AttributeName.CONTENTS_CHAPTER_NUM_CLASSNAME;

    AttributeName.CONTENTS_CHAPTER_MAX_CLASSNAME = constant.Run.AttributeName.CONTENTS_CHAPTER_MAX_CLASSNAME;

    AttributeName.CONTENTS_FORK_NUM_CLASSNAME = constant.Run.AttributeName.CONTENTS_FORK_NUM_CLASSNAME;

    AttributeName.CONTENTS_TAGS_CLASSNAME = constant.Run.AttributeName.CONTENTS_TAGS_CLASSNAME;

    return AttributeName;

  })();

  RunCommon.Key = (function() {
    function Key() {}

    Key.TARGET_PAGES = constant.Run.Key.TARGET_PAGES;

    Key.LOADED_CLASS_DIST_TOKENS = constant.Run.Key.LOADED_CLASS_DIST_TOKENS;

    Key.PROJECT_ID = constant.Run.Key.PROJECT_ID;

    Key.ACCESS_TOKEN = constant.Run.Key.ACCESS_TOKEN;

    Key.RUNNING_USER_PAGEVALUE_ID = constant.Run.Key.RUNNING_USER_PAGEVALUE_ID;

    Key.FOOTPRINT_PAGE_VALUE = constant.Run.Key.FOOTPRINT_PAGE_VALUE;

    Key.LOAD_FOOTPRINT = constant.Run.Key.LOAD_FOOTPRINT;

    return Key;

  })();

  RunCommon.initView = function() {
    $(window.drawingCanvas).attr('width', window.canvasWrapper.width());
    $(window.drawingCanvas).attr('height', window.canvasWrapper.height());
    window.scrollHandleWrapper.css('pointer-events', '');
    scrollInsideWrapper.width(window.scrollViewSize);
    scrollInsideWrapper.height(window.scrollViewSize);
    scrollInsideCover.width(window.scrollViewSize);
    scrollInsideCover.height(window.scrollViewSize);
    scrollHandle.width(window.scrollViewSize);
    scrollHandle.height(window.scrollViewSize);
    this.initHandleScrollView();
    return Common.initScrollContentsPosition();
  };

  RunCommon.updateMainViewSize = function() {
    var contentsHeight, contentsWidth, heightPadding, heightRate, projectScreenSize, scaleFromViewRate, updatedProjectScreenSize, widthPadding, widthRate;
    if (!Common.isFixedScreenSize()) {
      window.runScaleFromViewRate = 1.0;
      $('#project_wrapper').removeAttr('style');
    } else {
      contentsWidth = $('#contents').width();
      contentsHeight = $('#contents').height();
      projectScreenSize = Common.getScreenSize();
      updatedProjectScreenSize = $.extend(true, {}, projectScreenSize);
      widthPadding = 30;
      if ($('#project_wrapper').hasClass('fullscreen')) {
        widthPadding = 0;
      }
      heightPadding = 10;
      if ($('#project_wrapper').hasClass('fullscreen')) {
        heightPadding = 0;
      }
      if (contentsWidth < projectScreenSize.width + widthPadding) {
        updatedProjectScreenSize.width = contentsWidth - widthPadding;
      }
      if (contentsHeight < projectScreenSize.height + heightPadding) {
        updatedProjectScreenSize.height = contentsHeight - heightPadding;
      }
      widthRate = updatedProjectScreenSize.width / projectScreenSize.width;
      heightRate = updatedProjectScreenSize.height / projectScreenSize.height;
      if (widthRate < heightRate) {
        scaleFromViewRate = widthRate;
      } else {
        scaleFromViewRate = heightRate;
      }
      if (scaleFromViewRate === 0.0) {
        scaleFromViewRate = 0.01;
      }
      window.runScaleFromViewRate = scaleFromViewRate;
      updatedProjectScreenSize.width = projectScreenSize.width * scaleFromViewRate;
      updatedProjectScreenSize.height = projectScreenSize.height * scaleFromViewRate;
      $('#project_wrapper').css({
        width: updatedProjectScreenSize.width,
        height: updatedProjectScreenSize.height
      });
      Common.applyViewScale();
    }
    return Common.saveMainWrapperSize();
  };

  RunCommon.resizeMainContainerEvent = function() {
    var beforeMainWrapperSize, nowMainWrapperSize;
    beforeMainWrapperSize = window.mainWrapperSize;
    this.updateMainViewSize();
    Common.updateCanvasSize();
    if (!Common.isFixedScreenSize()) {
      nowMainWrapperSize = {
        width: window.mainWrapper.width(),
        height: window.mainWrapper.height()
      };
      return this.adjustScrollPositionWhenScreenSizeChanging(beforeMainWrapperSize, nowMainWrapperSize);
    }
  };

  RunCommon.adjustScrollPositionWhenScreenSizeChanging = function(beforeSize, afterSize) {
    var diff, scale;
    scale = Common.getViewScale();
    diff = {
      width: (beforeSize.width - afterSize.width) * 0.5 / scale,
      height: (beforeSize.height - afterSize.height) * 0.5 / scale
    };
    diff.width = diff.width >= 0 ? Math.ceil(diff.width) : Math.floor(diff.width);
    diff.height = diff.height >= 0 ? Math.ceil(diff.height) : Math.floor(diff.height);
    window.scrollContents.scrollTop(window.scrollContents.scrollTop() + diff.height);
    return window.scrollContents.scrollLeft(window.scrollContents.scrollLeft() + diff.width);
  };

  RunCommon.resizeEvent = function() {
    if ((window.skipResizeEvent != null) && window.skipResizeEvent) {
      return window.skipResizeEvent = false;
    } else {
      return RunCommon.resizeMainContainerEvent();
    }
  };

  RunCommon.showCreatorInfo = function() {
    var _setClose, bookmark, info, operation, share;
    info = $('#contents').find('.contents_info:first');
    operation = $('#contents').find('.operation_parent:first');
    share = $('#contents').find('.share_info:first');
    bookmark = $('#contents').find('.bookmark_input:first');
    Common.markdownToHtml();
    _setClose = function() {
      return $('#contents').off('click.contents_info').on('click.contents_info', function(e) {
        if (info.is(':visible')) {
          e.preventDefault();
          e.stopPropagation();
          operation.fadeOut({
            duration: '200',
            queue: false
          });
          info.fadeOut({
            duration: '200',
            queue: false
          });
          $('#contents').off('click.contents_info');
        }
        if (share.is(':visible')) {
          share.fadeOut('200');
        }
        if (bookmark.is(':visible')) {
          return bookmark.fadeOut('200');
        }
      });
    };
    info.fadeIn('500', function() {
      _setClose.call(this);
      return setTimeout(function() {
        return info.fadeOut('500');
      }, 3000);
    });
    $('#contents .contents_info_show_button:first').off('click').on('click', (function(_this) {
      return function(e) {
        if (!info.is(':visible')) {
          e.preventDefault();
          e.stopPropagation();
          operation.fadeIn({
            duration: '200',
            queue: false
          });
          return info.fadeIn({
            duration: '200',
            queue: false,
            complete: function() {
              return _setClose.call(_this);
            }
          });
        }
      };
    })(this));
    if (!window.isMotionCheck) {
      $('#contents .bookmark_button:first').off('click').on('click', (function(_this) {
        return function(e) {
          var bookmarkButtonWrapper;
          e.preventDefault();
          e.stopPropagation();
          bookmarkButtonWrapper = $(e.target).closest('.bookmark_button');
          if (bookmarkButtonWrapper.find('.bookmarked:visible').length === 0) {
            if (!bookmark.is(':visible')) {
              bookmark.find('textarea.note').val('');
              bookmark.find('textarea, input').off('click.close').on('click.close', function(ee) {
                ee.preventDefault();
                return ee.stopPropagation();
              });
              return bookmark.fadeIn('200', function() {
                _setClose.call(_this);
                return bookmark.find('.post_button:first').off('click').on('click', function(ee) {
                  ee.preventDefault();
                  ee.stopPropagation();
                  Common.showModalFlashMessage('Please wait...');
                  return GalleryCommon.addBookmark(bookmark.find('textarea.note').val(), function(result) {
                    if (result) {
                      bookmarkButtonWrapper.find('.bookmarked').show();
                      bookmarkButtonWrapper.find('.bookmark').hide();
                      bookmark.fadeOut('200');
                    }
                    return Common.hideModalView();
                  });
                });
              });
            }
          } else {
            if (window.confirm(I18n.t('message.dialog.change_project'))) {
              Common.showModalFlashMessage('Please wait...');
              return GalleryCommon.removeBookmark(function(result) {
                if (result) {
                  bookmarkButtonWrapper.find('.bookmarked').hide();
                  bookmarkButtonWrapper.find('.bookmark').show();
                  return Common.hideModalView();
                }
              });
            }
          }
        };
      })(this));
      $('#contents .contents_share_show_button:first').off('click').on('click', (function(_this) {
        return function(e) {
          if (!share.is(':visible')) {
            e.preventDefault();
            e.stopPropagation();
            return share.fadeIn('200', function() {
              return _setClose.call(_this);
            });
          }
        };
      })(this));
      return share.find('textarea, input').off('click.close').on('click.close', function(e) {
        e.preventDefault();
        e.stopPropagation();
        return $(this).select();
      });
    }
  };

  RunCommon.initEventAction = function() {
    var forkEventPageValueList, i, j, k, l, page, pageCount, pageList, pageNum, ref, ref1;
    pageCount = PageValue.getPageCount();
    pageNum = PageValue.getPageNum();
    pageList = new Array(pageCount);
    for (i = k = 1, ref = pageCount; 1 <= ref ? k <= ref : k >= ref; i = 1 <= ref ? ++k : --k) {
      if (i === parseInt(pageNum)) {
        forkEventPageValueList = {};
        for (j = l = 0, ref1 = PageValue.getForkCount(); 0 <= ref1 ? l <= ref1 : l >= ref1; j = 0 <= ref1 ? ++l : --l) {
          forkEventPageValueList[j] = PageValue.getEventPageValueSortedListByNum(j, i);
        }
        page = new Page({
          forks: forkEventPageValueList
        });
        pageList[i - 1] = page;
      } else {
        pageList[i - 1] = null;
      }
    }
    RunCommon.setPageMax(pageCount);
    window.eventAction = new EventAction(pageList, PageValue.getPageNum() - 1);
    return window.eventAction.start();
  };

  RunCommon.initOperationEvent = function() {
    var operationWrapper;
    operationWrapper = $('.operation_wrapper');
    operationWrapper.find('.rewind_all_capter').off('click').on('click', (function(_this) {
      return function(e) {
        if (window.eventAction != null) {
          e.preventDefault();
          e.stopPropagation();
          window.eventAction.thisPage().rewindAllChapters();
          if ($(e.target).closest('.info_contents') != null) {
            return RunFullScreen.hidePopupInfo();
          }
        }
      };
    })(this));
    return operationWrapper.find('.rewind_capter').off('click').on('click', (function(_this) {
      return function(e) {
        if (window.eventAction != null) {
          e.preventDefault();
          e.stopPropagation();
          window.eventAction.thisPage().rewindChapter();
          if ($(e.target).closest('.info_contents') != null) {
            return RunFullScreen.hidePopupInfo();
          }
        }
      };
    })(this));
  };

  RunCommon.initHandleScrollView = function(withSetupScrollEvent) {
    if (withSetupScrollEvent == null) {
      withSetupScrollEvent = true;
    }
    window.skipScrollEvent = true;
    window.scrollHandleWrapper.scrollLeft(window.scrollHandle.width() * 0.5);
    window.scrollHandleWrapper.scrollTop(window.scrollHandle.height() * 0.5);
    if (withSetupScrollEvent) {
      return this.setupScrollEvent();
    }
  };

  RunCommon.setupScrollEvent = function() {
    window.lastLeft = window.scrollHandleWrapper.scrollLeft();
    window.lastTop = window.scrollHandleWrapper.scrollTop();
    return window.scrollHandleWrapper.off('scroll').on('scroll', (function(_this) {
      return function(e) {
        var distX, distY, target, x, y;
        e.preventDefault();
        e.stopPropagation();
        target = $(e.target);
        x = target.scrollLeft();
        y = target.scrollTop();
        if (((window.scrollRunning != null) && window.scrollRunning) || !RunCommon.enabledScroll()) {
          return;
        }
        if ((window.skipScrollEvent != null) && window.skipScrollEvent) {
          window.skipScrollEvent = false;
          return;
        }
        distX = x - window.lastLeft;
        distY = y - window.lastTop;
        window.scrollRunning = true;
        if (window.scrollRunningTimer != null) {
          clearTimeout(window.scrollRunningTimer);
          window.scrollRunningTimer = null;
        }
        window.scrollRunningTimer = setTimeout(function() {
          window.scrollRunning = true;
          RunCommon.initHandleScrollView(false);
          window.lastLeft = window.scrollHandleWrapper.scrollLeft();
          window.lastTop = window.scrollHandleWrapper.scrollTop();
          clearTimeout(window.scrollRunningTimer);
          window.scrollRunningTimer = null;
          return window.scrollRunning = false;
        }, 3000);
        window.eventAction.thisPage().handleScrollEvent(distX, distY);
        window.lastLeft = window.scrollHandleWrapper.scrollLeft();
        window.lastTop = window.scrollHandleWrapper.scrollTop();
        return window.scrollRunning = false;
      };
    })(this));
  };

  RunCommon.enabledScroll = function() {
    var ret;
    ret = false;
    if ((window.eventAction != null) && (window.eventAction.thisPage() != null) && (window.eventAction.thisPage().finishedAllChapters || ((window.eventAction.thisPage().thisChapter() != null) && window.eventAction.thisPage().isScrollChapter()))) {
      ret = true;
    }
    return ret;
  };

  RunCommon.loadPagingPageValue = function(loadPageNum, doLoadFootprint, callback, forceUpdate) {
    var className, data, i, k, lastPageNum, ref, ref1, section, targetPages;
    if (doLoadFootprint == null) {
      doLoadFootprint = false;
    }
    if (callback == null) {
      callback = null;
    }
    if (forceUpdate == null) {
      forceUpdate = false;
    }
    lastPageNum = loadPageNum + Constant.Paging.PRELOAD_PAGEVALUE_NUM;
    targetPages = [];
    for (i = k = ref = loadPageNum, ref1 = lastPageNum; ref <= ref1 ? k <= ref1 : k >= ref1; i = ref <= ref1 ? ++k : --k) {
      if (forceUpdate) {
        targetPages.push(i);
      } else {
        className = constant.Paging.MAIN_PAGING_SECTION_CLASS.replace('@pagenum', i);
        section = $("#" + constant.Paging.ROOT_ID).find("." + className + ":first");
        if ((section == null) || section.length === 0) {
          targetPages.push(i);
        }
      }
    }
    if (targetPages.length === 0) {
      if (callback != null) {
        callback();
      }
      return;
    }
    data = {};
    data[RunCommon.Key.TARGET_PAGES] = targetPages;
    data[RunCommon.Key.LOADED_CLASS_DIST_TOKENS] = JSON.stringify(PageValue.getLoadedclassDistTokens());
    data[RunCommon.Key.ACCESS_TOKEN] = Common.getContentsAccessTokenFromUrl();
    data[RunCommon.Key.RUNNING_USER_PAGEVALUE_ID] = PageValue.getGeneralPageValue(PageValue.Key.RUNNING_USER_PAGEVALUE_ID);
    if (window.isMotionCheck && doLoadFootprint) {
      data[RunCommon.Key.LOAD_FOOTPRINT] = false;
      window.lStorage.loadPagingFootprintPageValue(loadPageNum);
    } else {
      data[RunCommon.Key.LOAD_FOOTPRINT] = doLoadFootprint;
    }
    return $.ajax({
      url: "/run/paging",
      type: "POST",
      dataType: "json",
      data: data,
      success: function(data) {
        if (data.resultSuccess) {
          return Common.setupJsByList(data.itemJsList, function() {
            if (data.pagevalues != null) {
              if (data.pagevalues.general_pagevalue != null) {
                PageValue.setGeneralPageValue(PageValue.Key.G_PREFIX, data.pagevalues.general_pagevalue, true);
              }
              if (data.pagevalues.instance_pagevalue != null) {
                PageValue.setInstancePageValue(PageValue.Key.INSTANCE_PREFIX, data.pagevalues.instance_pagevalue, true);
              }
              if (data.pagevalues.event_pagevalue != null) {
                PageValue.setEventPageValue(PageValue.Key.E_SUB_ROOT, data.pagevalues.event_pagevalue, true);
              }
              if (data.pagevalues.footprint != null) {
                PageValue.setFootprintPageValue(PageValue.Key.F_PREFIX, data.pagevalues.footprint, true);
              }
            }
            if (callback != null) {
              return callback();
            }
          });
        } else {
          console.log('/run/paging server error');
          return Common.ajaxError(data);
        }
      },
      error: function(data) {
        console.log('/run/paging ajax error');
        return Common.ajaxError(data);
      }
    });
  };

  RunCommon.getForkStack = function(pn) {
    return PageValue.getFootprintPageValue(PageValue.Key.forkStack(pn));
  };

  RunCommon.setForkStack = function(obj, pn) {
    return PageValue.setFootprintPageValue(PageValue.Key.forkStack(pn), [obj]);
  };

  RunCommon.initForkStack = function(forkNum, pn) {
    this.setForkStack({
      changedChapterIndex: 0,
      forkNum: forkNum
    }, pn);
    return true;
  };

  RunCommon.addForkNumToStack = function(forkNum, cIndex, pn) {
    var lastForkNum, stack;
    lastForkNum = this.getLastForkNumFromStack(pn);
    if ((lastForkNum != null) && lastForkNum !== forkNum) {
      stack = this.getForkStack(pn);
      stack.push({
        changedChapterIndex: cIndex,
        forkNum: forkNum
      });
      PageValue.setFootprintPageValue(PageValue.Key.forkStack(pn), stack);
      return true;
    } else {
      return false;
    }
  };

  RunCommon.getLastObjestFromStack = function(pn) {
    var stack;
    stack = this.getForkStack(pn);
    if ((stack != null) && stack.length > 0) {
      return stack[stack.length - 1];
    } else {
      return null;
    }
  };

  RunCommon.getLastForkNumFromStack = function(pn) {
    var obj;
    obj = this.getLastObjestFromStack(pn);
    if (obj != null) {
      return obj.forkNum;
    } else {
      return null;
    }
  };

  RunCommon.getOneBeforeObjestFromStack = function(pn) {
    var stack;
    stack = this.getForkStack(pn);
    if ((stack != null) && stack.length > 1) {
      return stack[stack.length - 2];
    } else {
      return null;
    }
  };

  RunCommon.popLastForkNumInStack = function(pn) {
    var stack;
    stack = this.getForkStack(pn);
    stack.pop();
    PageValue.setFootprintPageValue(PageValue.Key.forkStack(pn), stack);
    return true;
  };

  RunCommon.showUploadGalleryConfirm = function() {
    var root;
    root = $('#nav');
    $("input[name='" + constant.Gallery.Key.PROJECT_ID + "']", root).val(PageValue.getGeneralPageValue(PageValue.Key.PROJECT_ID));
    if (Common.isFixedScreenSize()) {
      $("input[name='" + constant.Gallery.Key.SCREEN_SIZE + "']", root).val(JSON.stringify(PageValue.getGeneralPageValue(PageValue.Key.SCREEN_SIZE)));
    }
    $("input[name='" + constant.Gallery.Key.PAGE_MAX + "']", root).val(PageValue.getPageCount());
    return document.upload_gallery_form.submit();
  };

  RunCommon.initMainContainer = function() {
    CommonVar.runCommonVar();
    this.initView();
    this.initHandleScrollView();
    Common.initResize(this.resizeEvent);
    Navbar.initRunNavbar();
    Common.applyEnvironmentFromPagevalue();
    return RunCommon.updateMainViewSize();
  };

  RunCommon.setCreator = function(value) {
    var e;
    e = $("." + this.AttributeName.CONTENTS_CREATOR_CLASSNAME);
    if (e != null) {
      return e.html(value);
    } else {
      return e.html('');
    }
  };

  RunCommon.setTitle = function(title_name) {
    var base, e;
    if (title_name != null) {
      base = title_name;
      if (!window.isWorkTable) {
        title_name += '(Preview)';
      }
      $("#" + Navbar.NAVBAR_ROOT).find('.nav_title').html(title_name);
      e = $("." + this.AttributeName.CONTENTS_TITLE_CLASSNAME);
      if ((title_name != null) && title_name.length > 0) {
        document.title = title_name;
      } else {
        document.title = window.appName;
      }
      e = $("." + this.AttributeName.CONTENTS_TITLE_CLASSNAME);
      if (e != null) {
        return e.html(base);
      } else {
        return e.html('');
      }
    }
  };

  RunCommon.setPageNum = function(value) {
    var e;
    e = $("." + this.AttributeName.CONTENTS_PAGE_NUM_CLASSNAME);
    if (e != null) {
      return e.html(value);
    } else {
      return e.html('');
    }
  };

  RunCommon.setChapterNum = function(value) {
    var e;
    e = $("." + this.AttributeName.CONTENTS_CHAPTER_NUM_CLASSNAME);
    if (e != null) {
      return e.html(value);
    } else {
      return e.html('');
    }
  };

  RunCommon.setPageMax = function(page_max) {
    var e;
    e = $("." + this.AttributeName.CONTENTS_PAGE_MAX_CLASSNAME);
    if (e != null) {
      return e.html(page_max);
    } else {
      return e.html('');
    }
  };

  RunCommon.setChapterMax = function(chapter_max) {
    var e;
    e = $("." + this.AttributeName.CONTENTS_CHAPTER_MAX_CLASSNAME);
    if (e != null) {
      return e.html(chapter_max);
    } else {
      return e.html('');
    }
  };

  RunCommon.setForkNum = function(num) {
    var e;
    e = $("." + this.AttributeName.CONTENTS_FORK_NUM_CLASSNAME);
    if (e != null) {
      e.html(num);
      return e.closest('li').css('display', num > 0 ? 'block' : 'none');
    } else {
      e.html('');
      return e.closest('li').hide();
    }
  };

  RunCommon.saveFootprint = function(callback) {
    var data;
    if (callback == null) {
      callback = null;
    }
    if ((window.isMotionCheck != null) && window.isMotionCheck) {
      window.lStorage.saveFootprintPageValue();
      if (callback != null) {
        return callback();
      }
    } else {
      data = {};
      data[RunCommon.Key.ACCESS_TOKEN] = Common.getContentsAccessTokenFromUrl();
      data[RunCommon.Key.FOOTPRINT_PAGE_VALUE] = JSON.stringify(PageValue.getFootprintPageValue(PageValue.Key.F_PREFIX));
      return $.ajax({
        url: "/run/save_gallery_footprint",
        type: "POST",
        data: data,
        dataType: "json",
        success: function(data) {
          if (data.resultSuccess) {
            if (callback != null) {
              return callback();
            }
          } else {
            console.log('/run/save_gallery_footprint server error');
            return Common.ajaxError(data);
          }
        },
        error: function(data) {
          console.log('/run/save_gallery_footprint ajax error');
          return Common.ajaxError(data);
        }
      });
    }
  };

  RunCommon.loadCommonFootprint = function(callback) {
    var data;
    if (callback == null) {
      callback = null;
    }
    if ((window.isMotionCheck != null) && window.isMotionCheck) {
      window.lStorage.loadCommonFootprintPageValue();
      if (callback != null) {
        return callback();
      }
    } else {
      data = {};
      data[RunCommon.Key.ACCESS_TOKEN] = Common.getContentsAccessTokenFromUrl();
      return $.ajax({
        url: "/run/load_common_gallery_footprint",
        type: "POST",
        data: data,
        dataType: "json",
        success: function(data) {
          if (data.resultSuccess) {
            PageValue.setFootprintPageValue(PageValue.Key.F_PREFIX, data.pagevalue_data);
            if (callback != null) {
              return callback();
            }
          } else {
            console.log('/run/load_common_gallery_footprint server error');
            return Common.ajaxError(data);
          }
        },
        error: function(data) {
          console.log('/run/load_common_gallery_footprint ajax error');
          return Common.ajaxError(data);
        }
      });
    }
  };

  RunCommon.start = function(useLocalStorate) {
    var is_reload;
    if (useLocalStorate == null) {
      useLocalStorate = false;
    }
    window.eventAction = null;
    window.runPage = true;
    window.initDone = false;
    window.runScaleFromViewRate = 1.0;
    Common.showModalFlashMessage('Getting ready');
    CommonVar.initVarWhenLoadedView();
    CommonVar.initCommonVar();
    if (useLocalStorate) {
      is_reload = PageValue.getInstancePageValue(PageValue.Key.IS_RUNWINDOW_RELOAD);
      if (is_reload != null) {
        window.lStorage.loadAllPageValues();
      } else {
        PageValue.setPageNum(1);
        PageValue.removeAllFootprint();
        window.lStorage.saveAllPageValues();
      }
    }
    Common.createdMainContainerIfNeeded(PageValue.getPageNum());
    RunCommon.initMainContainer();
    return Common.loadJsFromInstancePageValue(function() {
      RunCommon.initEventAction();
      RunCommon.initOperationEvent();
      Common.hideModalView();
      return window.initDone = true;
    });
  };

  RunCommon.shutdown = function() {
    if (window.eventAction != null) {
      return window.eventAction.shutdown();
    }
  };

  return RunCommon;

})();

//# sourceMappingURL=run_common.js.map
