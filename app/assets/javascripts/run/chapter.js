// Generated by CoffeeScript 1.9.2
var Chapter;

Chapter = (function() {
  Chapter.guideTimer = null;

  function Chapter(list) {
    var distId, event, i, id, len, obj, ref;
    this.eventList = list.eventList;
    this.num = list.num;
    this.eventObjList = [];
    ref = this.eventList;
    for (i = 0, len = ref.length; i < len; i++) {
      obj = ref[i];
      id = obj[EventPageValueBase.PageValueKey.ID];
      distId = obj[EventPageValueBase.PageValueKey.CLASS_DIST_TOKEN];
      event = Common.getInstanceFromMap(id, distId);
      this.eventObjList.push(event);
    }
    this.doMoveChapter = false;
  }

  Chapter.prototype.willChapter = function() {
    var event, i, idx, len, ref;
    if (window.runDebug) {
      console.log('Chapter willChapter');
    }
    ref = this.eventObjList;
    for (idx = i = 0, len = ref.length; i < len; idx = ++i) {
      event = ref[idx];
      event.initEvent(this.eventList[idx]);
      event.willChapter();
      this.doMoveChapter = false;
    }
    this.focusToActorIfNeed(false);
    return this.enableEventHandle();
  };

  Chapter.prototype.didChapter = function() {
    if (window.runDebug) {
      console.log('Chapter didChapter');
    }
    return this.eventObjList.forEach(function(event) {
      return event.didChapter();
    });
  };

  Chapter.prototype.focusToActorIfNeed = function(isImmediate, type) {
    var item;
    if (type == null) {
      type = "center";
    }
    window.disabledEventHandler = true;
    item = null;
    this.eventObjList.forEach((function(_this) {
      return function(e, idx) {
        if (_this.eventList[idx][EventPageValueBase.PageValueKey.IS_COMMON_EVENT] === false && _this.eventList[idx][EventPageValueBase.PageValueKey.DO_FOCUS]) {
          item = e;
          return false;
        }
      };
    })(this));
    if (item != null) {
      if (type === 'center') {
        return Common.focusToTarget(item.getJQueryElement(), function() {
          return window.disabledEventHandler = false;
        }, isImmediate);
      }
    } else {
      return window.disabledEventHandler = false;
    }
  };

  Chapter.prototype.disableScrollHandleViewEvent = function() {
    if (window.runDebug) {
      console.log('Chapter floatAllChapterEvents');
    }
    return window.scrollHandleWrapper.css('pointer-events', 'none');
  };

  Chapter.prototype.enableScrollHandleViewEvent = function() {
    if (window.runDebug) {
      console.log('Chapter floatScrollHandleCanvas');
    }
    return window.scrollHandleWrapper.css('pointer-events', '');
  };

  Chapter.prototype.resetAllEvents = function(takeStateCapture, callback) {
    var count, e, i, idx, len, ref, results;
    if (takeStateCapture == null) {
      takeStateCapture = false;
    }
    if (callback == null) {
      callback = null;
    }
    if (window.runDebug) {
      console.log('Chapter resetAllEvents');
    }
    count = 0;
    ref = this.eventObjList;
    results = [];
    for (idx = i = 0, len = ref.length; i < len; idx = ++i) {
      e = ref[idx];
      e.initEvent(this.eventList[idx]);
      e.updateEventBefore();
      e.resetProgress();
      results.push(e.refresh(e.visible, (function(_this) {
        return function() {
          count += 1;
          if (count >= _this.eventObjList.length) {
            if (callback != null) {
              return callback();
            }
          }
        };
      })(this)));
    }
    return results;
  };

  Chapter.prototype.forwardAllEvents = function() {
    var e, i, idx, len, ref, results;
    if (window.runDebug) {
      console.log('Chapter forwardAllEvents');
    }
    ref = this.eventObjList;
    results = [];
    for (idx = i = 0, len = ref.length; i < len; idx = ++i) {
      e = ref[idx];
      e.initEvent(this.eventList[idx]);
      e.updateEventAfter();
      results.push(e.didChapter());
    }
    return results;
  };

  Chapter.prototype.showGuide = function(calledByWillChapter) {
    if (calledByWillChapter == null) {
      calledByWillChapter = false;
    }
    return RunSetting.isShowGuide();
  };

  Chapter.prototype.hideGuide = function() {};

  Chapter.prototype.enableEventHandle = function() {
    return this.eventObjList.forEach((function(_this) {
      return function(e) {
        return e._skipEvent = false;
      };
    })(this));
  };

  Chapter.prototype.disableEventHandle = function() {
    return this.eventObjList.forEach((function(_this) {
      return function(e) {
        return e._skipEvent = true;
      };
    })(this));
  };

  return Chapter;

})();

//# sourceMappingURL=chapter.js.map
