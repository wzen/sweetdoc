// Generated by CoffeeScript 1.9.2
$(function() {
  return $('.worktable.index').ready(function() {
    var _callback, loadWorktableFromCache;
    window.isItemPreview = false;
    window.initDone = false;
    if (!Common.checkBlowserEnvironment()) {
      Common.showModalView(Constant.ModalViewType.ENVIRONMENT_NOT_SUPPORT, false);
      return;
    }
    $.ajaxSetup({
      beforeSend: function(xhr) {
        return xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
      }
    });
    loadWorktableFromCache = WorktableCommon.checkLoadWorktableFromCache();
    if (loadWorktableFromCache) {
      LocalStorage.loadAllPageValues();
    }
    CommonVar.initVarWhenLoadedView();
    CommonVar.initCommonVar();
    Navbar.initWorktableNavbar();
    _callback = function() {
      OperationHistory.add(true);
      PageValue.updatePageCount();
      PageValue.updateForkCount();
      return Paging.initPaging();
    };
    if (loadWorktableFromCache) {
      Common.showModalFlashMessage('Loading cache');
      Common.createdMainContainerIfNeeded(PageValue.getPageNum());
      WorktableCommon.initMainContainer();
      Common.initResize(WorktableCommon.resizeEvent);
      PageValue.adjustInstanceAndEventOnPage();
      WorktableCommon.createAllInstanceAndDrawFromInstancePageValue(function() {
        WorktableCommon.createCommonEventInstancesOnThisPageIfNeeded();
        WorktableCommon.initScrollContentsPosition();
        _callback.call(this);
        Navbar.switchWorktableNavbarWhenProjectCreated(true);
        Common.hideModalView();
        return window.initDone = true;
      });
      return Timeline.refreshAllTimeline();
    } else {
      LocalStorage.clearWorktable();
      Timeline.refreshAllTimeline();
      _callback.call(this);
      Common.showModalView(Constant.ModalViewType.INIT_PROJECT, true, Project.initProjectModal);
      return Common.initResize();
    }
  });
});

//# sourceMappingURL=worktable.js.map
