// Generated by CoffeeScript 1.9.2
var addItemInfo, addTimelineEventContents, availJs, loadItemJs;

loadItemJs = function(itemIds, callback) {
  var callbackCount, i, itemId, itemInitFuncName, len, needReadItemIds;
  if (callback == null) {
    callback = null;
  }
  if (jQuery.type(itemIds) !== "array") {
    itemIds = [itemIds];
  }
  callbackCount = 0;
  needReadItemIds = [];
  for (i = 0, len = itemIds.length; i < len; i++) {
    itemId = itemIds[i];
    itemInitFuncName = getInitFuncName(itemId);
    if (window.itemInitFuncList[itemInitFuncName] != null) {
      window.itemInitFuncList[itemInitFuncName]();
      callbackCount += 1;
      if (callbackCount >= data.length) {
        if (callback != null) {
          callback();
        }
        return;
      }
    } else {
      needReadItemIds.push(itemId);
    }
  }
  return $.ajax({
    url: "/item_js/index",
    type: "POST",
    dataType: "json",
    data: {
      itemIds: needReadItemIds
    },
    success: function(data) {
      var d, j, len1, option, results;
      callbackCount = 0;
      results = [];
      for (j = 0, len1 = data.length; j < len1; j++) {
        d = data[j];
        if (d.css_info != null) {
          option = {
            isWorkTable: true,
            css_temp: d.css_info
          };
        }
        availJs(getInitFuncName(d.item_id), d.js_src, option, function() {
          callbackCount += 1;
          if ((callback != null) && callbackCount >= data.length) {
            return callback();
          }
        });
        addItemInfo(d.item_id, d.te_actions);
        results.push(addTimelineEventContents(d.item_id, d.te_actions, d.te_values));
      }
      return results;
    },
    error: function(data) {}
  });
};

availJs = function(initName, jsSrc, option, callback) {
  var firstScript, s, t;
  if (option == null) {
    option = {};
  }
  if (callback == null) {
    callback = null;
  }
  s = document.createElement('script');
  s.type = 'text/javascript';
  s.src = jsSrc;
  firstScript = document.getElementsByTagName('script')[0];
  firstScript.parentNode.insertBefore(s, firstScript);
  return t = setInterval(function() {
    if (window.itemInitFuncList[initName] != null) {
      clearInterval(t);
      window.itemInitFuncList[initName](option);
      if (callback != null) {
        return callback();
      }
    }
  }, '500');
};

addItemInfo = function(item_id, te_actions) {
  if ((te_actions != null) && te_actions.length > 0) {
    return te_actions.forEach(function(a) {
      if ((a.is_default != null) && a.is_default) {
        setPageValue(Constant.PageValueKey.ITEM_DEFAULT_METHODNAME.replace('@item_id', item_id), a.method_name);
        setPageValue(Constant.PageValueKey.ITEM_DEFAULT_ACTIONTYPE.replace('@item_id', item_id), a.action_event_type_id);
        return setPageValue(Constant.PageValueKey.ITEM_DEFAULT_ANIMATIONTYPE.replace('@item_id', item_id), a.action_animation_type_id);
      }
    });
  }
};

addTimelineEventContents = function(item_id, te_actions, te_values) {
  var actionParent, action_forms, className, handler_forms;
  if ((te_actions != null) && te_actions.length > 0) {
    className = TimelineConfig.ITEM_ACTION_CLASS.replace('@itemid', item_id);
    handler_forms = $('#timeline-config .handler_div .configBox');
    action_forms = $('#timeline-config .action_forms');
    if (action_forms.find("." + className).length === 0) {
      actionParent = $("<div class='" + className + "' style='display:none'></div>");
      te_actions.forEach(function(a) {
        var actionType, handlerClone, handlerParent, methodClone, span, valueClassName;
        actionType = getActionTypeClassNameByActionType(a.action_event_type_id);
        methodClone = $('#timeline-config .method_temp').children(':first').clone(true);
        span = methodClone.find('label:first').children('span:first');
        span.attr('class', actionType);
        span.html(a.options['name']);
        methodClone.find('input.action_type:first').val(a.action_event_type_id);
        methodClone.find('input.method_name:first').val(a.method_name);
        methodClone.find('input.animation_type:first').val(a.action_animation_type_id);
        valueClassName = TimelineConfig.ITEM_VALUES_CLASS.replace('@itemid', item_id).replace('@methodname', a.method_name);
        methodClone.find('input:radio').attr('name', className);
        methodClone.find('input.value_class_name:first').val(valueClassName);
        actionParent.append(methodClone);
        handlerClone = null;
        if (a.action_event_type_id === Constant.ActionEventHandleType.SCROLL) {
          handlerClone = $('#timeline-config .handler_scroll_temp').children().clone(true);
        } else if (a.action_event_type_id === Constant.ActionEventHandleType.CLICK) {
          handlerClone = $('#timeline-config .handler_click_temp').children().clone(true);
        }
        handlerParent = $("<div class='" + valueClassName + "' style='display:none'></div>");
        handlerParent.append(handlerClone);
        return handlerParent.appendTo(handler_forms);
      });
      actionParent.appendTo(action_forms);
    }
  }
  if (te_values != null) {
    return $(te_values).appendTo($('#timeline-config .value_forms'));
  }
};

//# sourceMappingURL=load_js.js.map
