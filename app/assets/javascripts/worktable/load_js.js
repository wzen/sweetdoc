// Generated by CoffeeScript 1.9.2
var addItemInfo, addTimelineEventContents, availJs, loadItemJs;

loadItemJs = function(itemId, callback) {
  var itemInitFuncName;
  if (callback == null) {
    callback = null;
  }
  itemInitFuncName = getInitFuncName(itemId);
  if (window.itemInitFuncList[itemInitFuncName] != null) {
    window.itemInitFuncList[itemInitFuncName]();
    if (callback != null) {
      callback();
    }
    return;
  }
  return $.ajax({
    url: "/item_js/index",
    type: "POST",
    dataType: "json",
    data: {
      itemId: itemId
    },
    success: function(data) {
      var option;
      if (data.css_info != null) {
        option = {
          isWorkTable: true,
          css_temp: data.css_info
        };
      }
      availJs(itemInitFuncName, data.js_src, option, callback);
      addItemInfo(data.item_id, data.te_actions);
      return addTimelineEventContents(data.item_id, data.te_actions, data.te_values);
    },
    error: function(data) {}
  });
};

availJs = function(initName, jsSrc, option, callback) {
  var firstScript, s, t;
  if (option == null) {
    option = {};
  }
  if (callback == null) {
    callback = null;
  }
  s = document.createElement('script');
  s.type = 'text/javascript';
  s.src = jsSrc;
  firstScript = document.getElementsByTagName('script')[0];
  firstScript.parentNode.insertBefore(s, firstScript);
  return t = setInterval(function() {
    if (window.itemInitFuncList[initName] != null) {
      clearInterval(t);
      window.itemInitFuncList[initName](option);
      if (callback != null) {
        return callback();
      }
    }
  }, '500');
};

addItemInfo = function(item_id, te_actions) {
  if ((te_actions != null) && te_actions.length > 0) {
    return te_actions.forEach(function(a) {
      if ((a.is_default != null) && a.is_default) {
        setPageValue(Constant.PageValueKey.ITEM_DEFAULT_METHODNAME.replace('@item_id', item_id), a.method_name);
        return setPageValue(Constant.PageValueKey.ITEM_DEFAULT_ACTIONTYPE.replace('@item_id', item_id), a.action_event_type_id);
      }
    });
  }
};

addTimelineEventContents = function(item_id, te_actions, te_values) {
  var action_forms, className, select;
  if ((te_actions != null) && te_actions.length > 0) {
    className = TimelineConfig.ACTION_CLASS.replace('@itemid', item_id);
    action_forms = $('#timeline-config .action_forms');
    if (action_forms.find("." + className).length === 0) {
      select = '';
      te_actions.forEach(function(a) {
        var actionType;
        actionType = getActionTypeClassNameByActionType(a.action_event_type_id);
        return select += "<div class='radio'>\n    <label><input type='radio' name='method'><span class='" + actionType + "'>" + a.options['name'] + "</span></label>\n    <input class='action_type' type='hidden' value='" + a.action_event_type_id + "'>\n    <input class='method_name' type='hidden' value='" + a.method_name + "'>\n    <input class='value_class_name' type='hidden' value='" + Constant.TIMELINE_COMMON_ACTION_PREFIX + item_id + "_" + a.method_name + "'>\n</div>";
      });
      $("<div class='" + className + "'>" + select + "</div>").appendTo(action_forms);
    }
  }
  if (te_values != null) {
    return $(te_values).appendTo($('#timeline-config .value_forms'));
  }
};

//# sourceMappingURL=load_js.js.map
