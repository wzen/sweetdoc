// Generated by CoffeeScript 1.9.2
var Paging;

Paging = (function() {
  function Paging() {}

  Paging.initPaging = function() {
    return this.createPageSelectMenu();
  };

  Paging.createPageSelectMenu = function() {
    var active, divider, i, j, menu, navMenuClass, navMenuName, newPageMenu, nowMenuName, pageCount, pageMenu, ref, root, selectRoot, self;
    self = this;
    pageCount = PageValue.getPageCount();
    root = $("#" + Constant.Paging.NAV_ROOT_ID);
    selectRoot = $("." + Constant.Paging.NAV_SELECT_ROOT_CLASS, root);
    menu = "<li><a class='" + Constant.Paging.NAV_MENU_CLASS + " menu-item'>" + Constant.Paging.NAV_MENU_NAME + "</a></li>";
    divider = "<li class='divider'></li>";
    newPageMenu = "<li><a class='" + Constant.Paging.NAV_MENU_ADDPAGE_CLASS + " menu-item'>Add next page</a></li>";
    pageMenu = '';
    for (i = j = 1, ref = pageCount; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {
      navMenuClass = Constant.Paging.NAV_MENU_CLASS.replace('@pagenum', i);
      navMenuName = Constant.Paging.NAV_MENU_NAME.replace('@pagenum', i);
      active = i === window.pageNum ? 'class="active"' : '';
      pageMenu += "<li " + active + "><a class='" + navMenuClass + " menu-item '>" + navMenuName + "</a></li>";
    }
    pageMenu += divider;
    pageMenu += newPageMenu;
    selectRoot.children().remove();
    $(pageMenu).appendTo(selectRoot);
    nowMenuName = Constant.Paging.NAV_MENU_NAME.replace('@pagenum', window.pageNum);
    $("." + Constant.Paging.NAV_SELECTED_CLASS, root).html(nowMenuName);
    selectRoot.find(".menu-item").off('click');
    selectRoot.find(".menu-item").on('click', function() {
      var classList, prefix;
      prefix = Constant.Paging.NAV_MENU_CLASS.replace('@pagenum', '');
      classList = this.classList;
      return classList.forEach(function(c) {
        var pageNum;
        if (c.indexOf(prefix) >= 0) {
          pageNum = parseInt(c.replace(prefix, ''));
          self.selectPage(pageNum);
          return false;
        }
      });
    });
    selectRoot.find("." + Constant.Paging.NAV_MENU_ADDPAGE_CLASS, root).off('click');
    return selectRoot.find("." + Constant.Paging.NAV_MENU_ADDPAGE_CLASS, root).on('click', function() {
      return self.createNewPage();
    });
  };

  Paging.createNewPage = function() {
    var beforePageNum, lstorage, self;
    self = this;
    beforePageNum = window.pageNum;
    Sidebar.closeSidebar();
    lstorage = localStorage;
    lstorage.removeItem(LocalStorage.Key.WORKTABLE_INSTANCE_PAGEVALUES);
    lstorage.removeItem(LocalStorage.Key.WORKTABLE_EVENT_PAGEVALUES);
    return Common.clearAllEventChange(function() {
      var pageFlip;
      WorktableCommon.removeAllItem();
      EventConfig.removeAllConfig();
      window.pageNum += 1;
      Common.createdMainContainerIfNeeded(window.pageNum);
      initMainContainer();
      PageValue.adjustInstanceAndEventOnThisPage();
      WorktableCommon.drawAllItemFromEventPageValue();
      pageFlip = new PageFlip(beforePageNum);
      return pageFlip.startRender(PageFlip.DIRECTION.FORWARD, function() {
        var className, section;
        className = Constant.Paging.MAIN_PAGING_SECTION_CLASS.replace('@pagenum', beforePageNum);
        section = $("#" + Constant.Paging.ROOT_ID).find("." + className + ":first");
        section.css('display', 'none');
        initMainContainer();
        Timeline.refreshAllTimeline();
        PageValue.setEventPageValue(PageValue.Key.eventCount(), 0);
        PageValue.updatePageCount();
        return self.createPageSelectMenu();
      });
    });
  };

  Paging.selectPage = function(selectedNum) {
    var beforePageNum, lstorage, pageCount, self;
    self = this;
    if (selectedNum <= 0) {
      return;
    }
    beforePageNum = window.pageNum;
    pageCount = PageValue.getPageCount();
    if (selectedNum < 0 || selectedNum > pageCount) {
      return;
    }
    Sidebar.closeSidebar();
    lstorage = localStorage;
    lstorage.removeItem(LocalStorage.Key.WORKTABLE_INSTANCE_PAGEVALUES);
    lstorage.removeItem(LocalStorage.Key.WORKTABLE_EVENT_PAGEVALUES);
    return Common.clearAllEventChange(function() {
      var className, direction, pageFlip, pn, section;
      WorktableCommon.removeAllItem();
      EventConfig.removeAllConfig();
      Common.createdMainContainerIfNeeded(selectedNum, beforePageNum > selectedNum);
      className = Constant.Paging.MAIN_PAGING_SECTION_CLASS.replace('@pagenum', selectedNum);
      section = $("#" + Constant.Paging.ROOT_ID).find("." + className + ":first");
      section.css('display', '');
      window.pageNum = selectedNum;
      initMainContainer();
      PageValue.adjustInstanceAndEventOnThisPage();
      WorktableCommon.drawAllItemFromEventPageValue();
      direction = beforePageNum < window.pageNum ? PageFlip.DIRECTION.FORWARD : PageFlip.DIRECTION.BACK;
      pn = beforePageNum < window.pageNum ? beforePageNum : window.pageNum;
      pageFlip = new PageFlip(pn);
      return pageFlip.startRender(direction, function() {
        className = Constant.Paging.MAIN_PAGING_SECTION_CLASS.replace('@pagenum', beforePageNum);
        section = $("#" + Constant.Paging.ROOT_ID).find("." + className + ":first");
        section.css('display', 'none');
        initMainContainer();
        Timeline.refreshAllTimeline();
        return self.createPageSelectMenu();
      });
    });
  };

  return Paging;

})();

//# sourceMappingURL=paging.js.map
