// Generated by CoffeeScript 1.9.2
var OperationHistory;

OperationHistory = (function() {
  var _pop, _popRedo;

  function OperationHistory() {}

  OperationHistory.Key = (function() {
    function Key() {}

    Key.INSTANCE = 'iv';

    Key.EVENT = 'ev';

    return Key;

  })();

  OperationHistory.add = function() {
    var obj;
    if (window.operationHistoryIndex != null) {
      window.operationHistoryIndex = (window.operationHistoryIndex + 1) % window.operationHistoryLimit;
    } else {
      window.operationHistoryIndex = 0;
    }
    window.operationHistoryTailIndex = window.operationHistoryIndex;
    obj = {};
    obj[this.Key.INSTANCE] = PageValue.getInstancePageValue(PageValue.Key.INSTANCE_PREFIX);
    obj[this.Key.EVENT] = PageValue.getEventPageValue(PageValue.Key.E_PREFIX);
    return window.operationHistory[window.operationHistoryIndex] = obj;
  };

  _pop = function() {
    var eventPageValue, hIndex, instancePageValue, obj;
    hIndex = window.operationHistoryIndex;
    if (hIndex <= 0) {
      hIndex = window.operationHistoryLimit - 1;
    } else {
      hIndex -= 1;
    }
    obj = window.operationHistory[hIndex];
    if (obj != null) {
      WorktableCommon.removeAllItemAndEvent();
      instancePageValue = obj[this.Key.INSTANCE];
      eventPageValue = obj[this.Key.EVENT];
      if (instancePageValue != null) {
        PageValue.setInstancePageValue(PageValue.Key.INSTANCE_PREFIX, instancePageValue);
      }
      if (eventPageValue != null) {
        PageValue.setEventPageValueByRootHash(eventPageValue);
      }
      window.operationHistoryIndex = hIndex;
      PageValue.adjustInstanceAndEvent();
      LocalStorage.saveEventPageValue();
      return WorktableCommon.drawAllItemFromEventPageValue();
    }
  };

  _popRedo = function() {
    var eventPageValue, hIndex, instancePageValue, obj;
    hIndex = (window.operationHistoryIndex + 1) % window.operationHistoryLimit;
    obj = window.operationHistory[hIndex];
    if (obj != null) {
      WorktableCommon.removeAllItemAndEvent();
      instancePageValue = obj[this.Key.INSTANCE];
      eventPageValue = obj[this.Key.EVENT];
      if (instancePageValue != null) {
        PageValue.setInstancePageValue(PageValue.Key.INSTANCE_PREFIX, instancePageValue);
      }
      if (eventPageValue != null) {
        PageValue.setEventPageValueByRootHash(eventPageValue);
      }
      window.operationHistoryIndex = hIndex;
      PageValue.adjustInstanceAndEvent();
      LocalStorage.saveEventPageValue();
      return WorktableCommon.drawAllItemFromEventPageValue();
    }
  };

  OperationHistory.undo = function() {
    var nextTailIndex;
    nextTailIndex = (window.operationHistoryTailIndex + 1) % window.operationHistoryLimit;
    if (nextTailIndex === window.operationHistoryIndex) {
      Message.flushWarn("Can't Undo");
      return;
    }
    return _pop.call(this);
  };

  OperationHistory.redo = function() {
    if (window.operationHistoryTailIndex === window.operationHistoryIndex) {
      Message.flushWarn("Can't Redo");
      return;
    }
    return _popRedo.call(this);
  };

  return OperationHistory;

})();

//# sourceMappingURL=history.js.map
