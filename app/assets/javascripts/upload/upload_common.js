// Generated by CoffeeScript 1.9.2
var UploadCommon;

UploadCommon = (function() {
  function UploadCommon() {}

  UploadCommon.initEvent = function(upload) {
    var mark, root;
    root = $('#upload_wrapper');
    $("." + constant.PreloadItemImage.Key.SELECT_FILE, root).off('change').on('change', (function(_this) {
      return function() {
        var f;
        f = $("." + constant.PreloadItemImage.Key.SELECT_FILE, root).val().split('.');
        if ((f != null) && f.length > 0) {
          window.uploadFileExt = f[f.length - 1];
          if (window.uploadFileExt === 'gif' || window.uploadFileExt === 'png' || (window.uploadFileExt = 'jpg')) {
            return $('.thumbnail_upload_form', root).submit();
          }
        }
      };
    })(this));
    $('.thumbnail_upload_form', root).off().on('ajax:complete', (function(_this) {
      return function(e, data, status, error) {
        var d, ext;
        d = JSON.parse(data.responseText);
        if ((d != null) && (d.image_url != null)) {
          ext = window.uploadFileExt;
          if (ext != null) {
            if (ext === 'gif') {
              ext = 'png';
            } else if (ext === 'jpg') {
              ext = 'jpeg';
            }
            return $('.capture', root).attr('src', "data:image/" + ext + ";base64," + d.image_url);
          }
        }
      };
    })(this));
    mark = $('.markItUp', root);
    if ((mark != null) && mark.length > 0) {
      $('.caption_markup', root).markItUpRemove();
    }
    $('.caption_markup', root).markItUp(mySettings);
    upload.prepareUploadTagEvent(root);
    $('.select_tag_input', root).off('keypress').on('keypress', function(e) {
      if (e.keyCode === constant.KeyboardKeyCode.ENTER) {
        upload.addUploadSelectTag(root, $(this).val());
        return $(this).val('');
      }
    });
    return $('.upload_button', root).off('click').on('click', function() {
      upload.upload(root);
      return false;
    });
  };

  UploadCommon.makeCapture = function(canvas) {
    var height, png, root, width;
    root = $('#upload_wrapper');
    try {
      png = canvas.toDataURL('image/png');
      $(".capture", root).attr('src', png);
      $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG + "']", root).val(png.replace(/^.*,/, ''));
    } catch (_error) {
      $(".capture", root).attr('src', '');
    }
    $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_CONTENTSTYPE + "']", root).val('image/png');
    width = parseInt($(canvas).attr('width'));
    height = parseInt($(canvas).attr('height'));
    $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_WIDTH + "']", root).val(width);
    $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_HEIGHT + "']", root).val(height);
    if (width > height) {
      return $(".capture", root).css({
        width: '100%',
        height: 'auto'
      });
    } else {
      return $(".capture", root).css({
        width: 'auto',
        height: '100%'
      });
    }
  };

  return UploadCommon;

})();

//# sourceMappingURL=upload_common.js.map
