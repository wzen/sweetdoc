// Generated by CoffeeScript 1.10.0
var UploadCommon;

UploadCommon = (function() {
  function UploadCommon() {}

  UploadCommon.initEvent = function(upload) {
    var mark, readImage, removeImage, root;
    root = $('#upload_wrapper');
    readImage = function(input) {
      var FR;
      if (input.files && input.files[0]) {
        FR = new FileReader();
        FR.onload = function(e) {
          var image;
          $('.capture', root).attr("src", e.target.result).show();
          $('.default_thumbnail', root).hide();
          $('.file_select_delete', root).show();
          image = new Image();
          image.src = e.target.result;
          return image.onload = function() {
            var contentType, imageData;
            imageData = e.target.result.split('base64,')[1];
            contentType = e.target.result.split(';base64')[0].replace('data:', '');
            $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG + "']", root).val(imageData.replace(/^.*,/, ''));
            $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_CONTENTSTYPE + "']", root).val(contentType);
            $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_WIDTH + "']", root).val(image.width);
            return $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_HEIGHT + "']", root).val(image.height);
          };
        };
        return FR.readAsDataURL(input.files[0]);
      } else {
        return removeImage.call(this);
      }
    };
    removeImage = function() {
      $('.capture', root).attr("src", "").hide();
      $('.default_thumbnail', root).show();
      return $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG + "']", root).val('');
    };
    $('#remove_image').click(function() {
      return removeImage.call(this);
    });
    $("." + constant.PreloadItemImage.Key.SELECT_FILE, root).off('change').on('change', (function(_this) {
      return function(e) {
        var f;
        window.uploadContents = upload;
        f = $("." + constant.PreloadItemImage.Key.SELECT_FILE, root).val();
        if ((f != null) && f.length > 0) {
          return readImage.call(_this, e.target);
        } else {
          return removeImage.call(_this);
        }
      };
    })(this));
    $("." + constant.PreloadItemImage.Key.SELECT_FILE_DELETE, root).off('click').on('click', (function(_this) {
      return function(e) {
        $("." + constant.PreloadItemImage.Key.SELECT_FILE, root).val('').trigger('change');
        $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG + "']", root).val('');
        $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_CONTENTSTYPE + "']", root).val('');
        $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_WIDTH + "']", root).val('');
        $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_HEIGHT + "']", root).val('');
        return $('.file_select_delete', root).hide();
      };
    })(this));
    mark = $('.markItUp', root);
    if ((mark != null) && mark.length > 0) {
      $('.caption_markup', root).markItUpRemove();
    }
    $('.caption_markup', root).markItUp(mySettings);
    upload.prepareUploadTagEvent(root);
    $('.select_tag_input', root).off('keypress').on('keypress', function(e) {
      if (e.keyCode === constant.KeyboardKeyCode.ENTER) {
        upload.addUploadSelectTag(root, $(this).val());
        return $(this).val('');
      }
    });
    return root.next('.button_wrapper').find('.upload_button').off('click').on('click', function() {
      upload.upload(root);
      return false;
    });
  };

  UploadCommon.makeCapture = function(canvas) {
    var error, height, png, root, width;
    root = $('#upload_wrapper');
    try {
      png = canvas.toDataURL('image/png');
      $(".capture", root).attr('src', png);
      $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG + "']", root).val(png.replace(/^.*,/, ''));
    } catch (error) {
      $(".capture", root).attr('src', '');
    }
    $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_CONTENTSTYPE + "']", root).val('image/png');
    width = parseInt($(canvas).attr('width'));
    height = parseInt($(canvas).attr('height'));
    $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_WIDTH + "']", root).val(width);
    $("input[name='" + constant.Gallery.Key.THUMBNAIL_IMG_HEIGHT + "']", root).val(height);
    if (width > height) {
      return $(".capture", root).css({
        width: '100%',
        height: 'auto'
      });
    } else {
      return $(".capture", root).css({
        width: 'auto',
        height: '100%'
      });
    }
  };

  return UploadCommon;

})();

//# sourceMappingURL=upload_common.js.map
